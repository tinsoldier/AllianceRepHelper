# Alliance Rep Helper

A Space Engineers mod that lets players choose to align with a configured NPC faction via a simple chat command. Designed for servers using Modular Encounters Systems (MES) and Alliance-style territorial gameplay where two or more NPC factions compete for territory.

Instead of relying on slow organic reputation grinding or requiring an admin to manually adjust faction relationships, players can commit to a faction with a single command.

## How It Works

When a player runs `/alliance <FactionTag>`:

1. Their reputation with the **chosen faction** is set to the configured ally value (default: **+1500**).
2. Their reputation with **all other configured factions** is set to the configured enemy value (default: **-1500**).
3. The choice is recorded and persisted per-world.

The mod only allows alignment with factions explicitly listed in the configuration file, and by default restricts selection to NPC-only factions. This prevents players from abusing the command to force relationships with player-run factions on PvP servers.

## Chat Commands

All commands are entered in the in-game chat. They are case-insensitive and are **not** visible to other players.

| Command | Description |
|---|---|
| `/alliance <FactionTag>` | Align with the specified faction. Sets your reputation to the configured ally value with that faction and the enemy value with all other configured factions. |
| `/alliance list` | Shows all factions available for alliance (as configured by the server owner). |
| `/alliance status` | Shows your current reputation with each configured faction and whether you have already made a choice. |
| `/alliance help` | Displays the in-game help text listing available commands. |

### Example

```
/alliance SOBAN
```

> You have aligned with [SOBAN] Soban Fleet!
> Reputation set to 1500 with [SOBAN].
> Reputation set to -1500 with all other alliance factions.

## Setup & Installation

1. Subscribe to the mod on the Steam Workshop, **or** place the built mod folder into your world's `Mods` directory.
2. Load or restart the world/server. On first load, the mod will generate a default configuration file.
3. Edit the configuration file to list the faction tags you want players to be able to align with.
4. Restart the world/server for configuration changes to take effect.

## Configuration

### File Location

The configuration file is stored in the **world storage** directory for the mod. The exact path depends on your setup:

- **Dedicated server:**
  `<SE Install>/Instances/<InstanceName>/Saves/<WorldName>/Storage/<ModId>.sbm_AllianceRepHelper/AllianceRepHelper.cfg`
- **Local / single-player:**
  `%AppData%/SpaceEngineers/Saves/<SteamId>/<WorldName>/Storage/<ModId>.sbm_AllianceRepHelper/AllianceRepHelper.cfg`

> **Note:** The `<ModId>.sbm_AllianceRepHelper` folder name is generated by the game based on the mod's Workshop ID (or local folder name) and the mod's namespace. If you can't find it, load the world once with the mod enabled and it will be created automatically with a default config.

### File Format

The config file uses a simple `Key = Value` format. Lines starting with `#` or `//` are treated as comments.

### Default Configuration

```ini
# Alliance Rep Helper Configuration
# -----------------------------------
# Comma-separated list of faction tags that players can align with.
# These MUST be set for the mod to function.
# Example: Factions = SOBAN, KHAANEPH
Factions = 

# Reputation value granted to the chosen ally faction (default: 1500)
AllyReputation = 1500

# Reputation value set for all OTHER configured factions (default: -1500)
EnemyReputation = -1500

# Only allow NPC factions to be selected (default: true)
# This prevents players from using the command to force relationships with player factions.
AllowOnlyNpcFactions = true
```

### Configuration Options

| Key | Type | Default | Description |
|---|---|---|---|
| `Factions` | Comma-separated strings | *(empty)* | **Required.** The faction tags that players can choose to align with. Must match the in-game faction tag exactly. Example: `SOBAN, KHAANEPH`. The mod will not function until at least one valid faction tag is configured. |
| `AllyReputation` | Integer | `1500` | The reputation value set between the player and their chosen faction. |
| `EnemyReputation` | Integer | `-1500` | The reputation value set between the player and all *other* configured factions. |
| `AllowOnlyNpcFactions` | Boolean | `true` | When `true`, factions listed in `Factions` are only allowed if they are NPC-only factions (i.e., contain no human players). Set to `false` if you need to include mixed or player factions in the list. |

### Example Configuration

For a server with two competing NPC alliances -- Soban and Khaaneph:

```ini
Factions = SOBAN, KHAANEPH
AllyReputation = 1500
EnemyReputation = -1500
AllowOnlyNpcFactions = true
```

## Player Choice Tracking

When a player uses the `/alliance` command, their Steam ID is recorded in a separate data file (`AllianceRepHelper_PlayerChoices.dat`) in the same world storage directory. This file is a simple list of Steam IDs, one per line.

This tracking is currently informational only -- the `/alliance status` command will tell the player whether they have already made a choice. **Enforcement of one-time-only usage is planned for a future update.**

> **Admin tip:** To reset a player's choice (e.g., if they want to switch sides), remove their Steam ID from the `AllianceRepHelper_PlayerChoices.dat` file and restart the server.

## Logging

The mod logs key events to the Space Engineers log file (`SpaceEngineers.log` or the dedicated server log):

- Configuration load/save
- Each reputation change (player identity, Steam ID, faction tag, reputation value)
- Errors during config or data file operations

All log entries are prefixed with `AllianceRepHelper:` for easy filtering.

## Technical Notes

- The mod runs as a **server-side session component**. Chat commands are processed on the server via the `MessageEnteredSender` event.
- On **dedicated servers**, feedback messages are sent to the player's client over a registered network channel (`ushort 39471`). On **single-player or listen servers**, messages are displayed directly.
- Reputation is set using `IMyFactionCollection.SetReputationBetweenPlayerAndFaction`, which is the standard ModAPI method for player-to-faction reputation.
- The mod targets **.NET Framework 4.8** and **C# 6.0**, built with [MDK2](https://github.com/malware-dev/MDK-SE).

## Planned Features (Phase 2+)

- [ ] Enforce one-time alliance choice (block repeat usage of `/alliance`)
- [ ] Optional cooldown or prerequisites before allowing alignment
- [ ] Admin override command to reset a player's choice in-game
- [ ] Configurable neutral-reputation requirement (must be neutral with all factions before choosing)
